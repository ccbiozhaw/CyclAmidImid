<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cytoscape.js Visualization</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/noUiSlider@15.8.6/dist/nouislider.min.css">
    <style>
        /* Global styles */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 100%;
            margin-top: 10px;
        }
        .sidebar {
            width: 20%;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .network-container {
            width: 80%;
            padding: 20px;
            box-sizing: border-box;
            height: 100vh;
            overflow: hidden;
            position: relative; /* Ensure position relative for loading indicator */
        }

        #cy {
            width: 100%;
            height: 100%;
        }

        #table-container {
            width: 100%;
            max-height: 300px;
            overflow: auto;
            padding: 10px;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
            white-space: nowrap;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            text-transform: uppercase;
            color: #333;
            cursor: pointer;
            user-select: none;
        }

        td {
            color: #666;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            .sidebar, .network-container {
                width: 100%;
            }
        }

        .sidebar input[type=text] {
            font-family: inherit;
            font-size: 1em;
            padding: 8px;
            width: 95%;
            box-sizing: border-box;
        }

        /* Style for dropdown */
    .sidebar select {
        width: 100%; /* Full width of container */
        padding: 10px; /* Add padding inside the dropdown */
        border: 1px solid #ccc; /* Light grey border */
        border-radius: 5px; /* Rounded corners */
        background-color: #ffffff; /* White background */
        font-size: 16px; /* Larger font size for readability */
        color: #333; /* Darker text color for contrast */
        appearance: none; /* Remove default arrow */
        -webkit-appearance: none; /* Remove default arrow in WebKit browsers */
        -moz-appearance: none; /* Remove default arrow in Firefox */
        cursor: pointer; /* Pointer cursor on hover */
        outline: none; /* Remove default focus outline */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        transition: border-color 0.3s ease, box-shadow 0.3s ease; /* Smooth transitions */
    }

    .sidebar select:focus {
        border-color: #0077C4; /* Change border color on focus */
        box-shadow: 0 0 0 2px rgba(0, 119, 196, 0.2); /* Add focus shadow */
    }

    /* Custom arrow */
    .sidebar select::-ms-expand {
        display: none; /* Hide default arrow in IE */
    }

    .sidebar select::before {
        content: 'â–¼'; /* Custom arrow */
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        font-size: 16px; /* Arrow size */
        color: #0077C4; /* Arrow color */
        pointer-events: none; /* Prevent arrow from interfering with dropdown interaction */
    }

    .sidebar select {
        position: relative; /* Position relative for custom arrow */
        padding-right: 30px; /* Space for custom arrow */
    }

        button {
            background-color: #0077C4;
            color: white;
            padding: 20px 40px;
            border: none;
            cursor: pointer;
            font-size: 18px;
            border-radius: 8px;
            background-size: cover;
            background-repeat: no-repeat;
            margin-right: 20px;
            margin-bottom: 20px;
            margin-left: 20px;
            margin-top: 20px;
        }

        button:hover {
            background-color: #0076c493;
        }

        .loading {
            font-size: 1.5em;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
            z-index: 1000; /* Ensure loading indicator is on top */
        }

        .progress-bar-container {
            width: 80%; /* Adjust as needed */
            height: 20px;
            background-color: #f3f3f3;
            border-radius: 10px;
            position: absolute;
            top: 50%;
            left: 10%;
            transform: translateY(-50%);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background-color: #0077C4;
            border-radius: 10px;
        }

        .slider-container {
            margin: 20px 0;
            height: 15px; /* Adjust height as needed */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Filters</h1>
            <div class="spaced-div">
                <label for="filter-annotation">Annotation:</label>
                <select id="filter-annotation">
                    <option value="">Select an annotation</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div class="spaced-div">
                <label for="filter-length">Length (Range):</label>
                <div id="filter-length-slider" class="slider-container"></div>
                <div class="range-label">
                    <span id="filter-length-min-value">0</span> - <span id="filter-length-max-value">100</span>
                </div>
            </div>

            <div class="spaced-div">
                <label for="filter-SeqID">SeqID (Range):</label>
                <div id="filter-seqID-slider" class="slider-container"></div>
                <div class="range-label">
                    <span id="filter-seqID-min-value">0</span> - <span id="filter-seqID-max-value">100</span>
                </div>
            </div>

            <button id="apply-filters">Apply Filters</button>
            <button id="reset-graph">Reset Graph</button>
        </div>

        <div class="network-container">
            <div id="loading-indicator" class="loading">Loading...</div>
            <div id="cy"></div>
            <div id="table-container">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>Annotation</th>
                            <th>Length</th>
                            <th>SeqID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table rows will be dynamically populated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/noUiSlider@15.8.6/dist/nouislider.min.js"></script>
    <script>
        // Initialize Cytoscape instance
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: [], // Initial empty elements array
            style: [ 
                { selector: 'node', style: { 'background-color': '#666', 'label': 'data(id)' } },
                { selector: 'edge', style: { 'width': 1, 'line-color': '#ddd' } }
            ],
            layout: { name: 'grid' }
        });

        const loadingIndicator = document.getElementById('loading-indicator');
        const progressBarContainer = document.createElement('div');
        progressBarContainer.className = 'progress-bar-container';
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        progressBarContainer.appendChild(progressBar);
        document.querySelector('.network-container').appendChild(progressBarContainer);

        function showLoading() {
            loadingIndicator.style.display = 'flex';
            progressBarContainer.style.display = 'block';
        }

        function hideLoading() {
            loadingIndicator.style.display = 'none';
            progressBarContainer.style.display = 'none';
        }

        function updateProgressBar(percentage) {
            progressBar.style.width = `${percentage}%`;
        }

        function fetchData() {
            showLoading();
            return new Promise((resolve, reject) => {
                // Simulating network request
                setTimeout(() => {
                    const data = [
                        // Sample data
                        { id: 'a', label: 'A', annotation: 'annot1', length: 50, seqID: 60 },
                        { id: 'b', label: 'B', annotation: 'annot2', length: 70, seqID: 80 }
                    ];
                    resolve(data);
                }, 2000);
            });
        }

        function updateTable(data) {
            const tableBody = document.querySelector('#data-table tbody');
            tableBody.innerHTML = '';
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.annotation}</td><td>${item.length}</td><td>${item.seqID}</td>`;
                tableBody.appendChild(row);
            });
        }

        function populateAnnotations(data) {
            const annotationSelect = document.getElementById('filter-annotation');
            const annotations = [...new Set(data.map(item => item.annotation))];
            annotationSelect.innerHTML = '<option value="">Select an annotation</option>';
            annotations.forEach(annotation => {
                const option = document.createElement('option');
                option.value = annotation;
                option.textContent = annotation;
                annotationSelect.appendChild(option);
            });
        }

        function applyFilters() {
            const annotation = document.getElementById('filter-annotation').value;
            const lengthValues = document.getElementById('filter-length-slider').noUiSlider.get();
            const seqIDValues = document.getElementById('filter-seqID-slider').noUiSlider.get();

            const lengthMin = parseFloat(lengthValues[0]);
            const lengthMax = parseFloat(lengthValues[1]);
            const seqIDMin = parseFloat(seqIDValues[0]);
            const seqIDMax = parseFloat(seqIDValues[1]);

            const filteredData = data.filter(item => 
                (annotation ? item.annotation === annotation : true) &&
                item.length >= lengthMin &&
                item.length <= lengthMax &&
                item.seqID >= seqIDMin &&
                item.seqID <= seqIDMax
            );

            updateTable(filteredData);
            // Update Cytoscape graph as needed
        }

        document.getElementById('apply-filters').addEventListener('click', applyFilters);

        document.getElementById('reset-graph').addEventListener('click', () => {
            document.getElementById('filter-annotation').value = '';
            document.getElementById('filter-length-slider').noUiSlider.set([0, 100]);
            document.getElementById('filter-seqID-slider').noUiSlider.set([0, 100]);
            applyFilters();
        });

        document.addEventListener('DOMContentLoaded', function() {
            const lengthSlider = document.getElementById('filter-length-slider');
            const seqIDSlider = document.getElementById('filter-seqID-slider');

            noUiSlider.create(lengthSlider, {
                start: [0, 100],
                connect: true,
                range: {
                    'min': 0,
                    'max': 100
                }
            });

            noUiSlider.create(seqIDSlider, {
                start: [0, 100],
                connect: true,
                range: {
                    'min': 0,
                    'max': 100
                }
            });

            lengthSlider.noUiSlider.on('update', function(values, handle) {
                document.getElementById('filter-length-min-value').textContent = Math.round(values[0]);
                document.getElementById('filter-length-max-value').textContent = Math.round(values[1]);
                applyFilters();
            });

            seqIDSlider.noUiSlider.on('update', function(values, handle) {
                document.getElementById('filter-seqID-min-value').textContent = Math.round(values[0]);
                document.getElementById('filter-seqID-max-value').textContent = Math.round(values[1]);
                applyFilters();
            });
        });

        fetchData().then(data => {
            updateTable(data);
            populateAnnotations(data);
            hideLoading();
        });
    </script>
</body>
</html>
